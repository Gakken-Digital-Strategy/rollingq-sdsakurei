$(function () {
  const main_img_wrappers = $(".main_img_wrapper");
  for (let i = 0; i < main_img_wrappers.length; i++) {
    const mainImg = $(`#crossfade${i}`);
    const sub_imgs = $(`.fadechild${i}`);
    const fadeSpeed = 200;
    for (sub_img of sub_imgs) {
      sub_img.addEventListener("click", function (e) {
        if (e.target.getAttribute("data-index") == mainImg.data("index"))
          return;
        else {
          const targetIndex = e.target.getAttribute("data-index");
          const originalIndex = mainImg.data("index");
          $(`#crossfade${i} img:nth-child(${targetIndex})`).animate(
            { opacity: "1", zIndex: "6" },
            fadeSpeed
          );
          $(`#crossfade${i} img:nth-child(${originalIndex})`).animate(
            { opacity: "0" },
            fadeSpeed
          );
          mainImg.data("index", targetIndex);
        }
      });
    }
  }
});

$(function () {
  const all_parts_buttons = $(".all_parts_button");
  for (let i = 0; i < all_parts_buttons.length; i++) {
    const button = all_parts_buttons[i];
    button.addEventListener("click", function () {
      $(`#parts_detail${i}`).slideToggle();
      $(`#parts_detail${i}`).toggleClass("open");
      $(`.all_parts_button:eq(${i})`).toggleClass("open");
    });
  }
});

$(function () {
  $("#nav-news").on("click", function () {
    $("html, body").animate(
      {
        scrollTop: $("#whats_new_container").position().top,
      },
      800,
      "swing"
    );
  });
  $("#nav-products").on("click", function () {
    $("html, body").animate(
      {
        scrollTop: $("#item_info_container").position().top,
      },
      800,
      "swing"
    );
  });
  $("#nav-howto").on("click", function () {
    $("html, body").animate(
      {
        scrollTop: $("#how_to_play_container").position().top,
      },
      800,
      "swing"
    );
  });
  $("#nav-exmaples").on("click", function () {
    $("html, body").animate(
      {
        scrollTop: $("#make_example_container").position().top,
      },
      800,
      "swing"
    );
  });
  $("#go_startex_button").on("click", function () {
    $("html, body").animate(
      {
        scrollTop: $("#example_startset").position().top - 80,
      },
      800,
      "swing"
    );
  });
  $("#go_dxex_button").on("click", function () {
    $("html, body").animate(
      {
        scrollTop: $("#example_dxset").position().top - 80,
      },
      800,
      "swing"
    );
  });

  $(function () {
    const read_more_buttons = $(".comment_read_more_button");
    for (let i = 0; i < read_more_buttons.length; i++) {
      const button = read_more_buttons[i];
      button.addEventListener("click", function () {
        $(`.comment_read_more_button:eq(${i})`).toggleClass("open");
        $(`.start-hide:eq(${i})`).slideToggle();
        $(`.start-hide:eq(${i})`).toggleClass("open");
      });
    }
  });

  $(function () {
    var trWithUrls = document.getElementsByClassName("external_site");
    for (var i = 0; i < trWithUrls.length; i++) {
      let url = trWithUrls[i].getAttribute("data-url");
      trWithUrls[i].addEventListener("click", function () {
        window.open(url, "_blank");
      });
    }
  });

  $(function () {
    const targets = {
      item_info: "#item_info_container",
      examples: "#make_example_container",
      ex_start: "#example_startset",
      ex_dx: "#example_dxset",
    };
    const internal_site_jumps = $(".internal_site");
    for (let i = 0; i < internal_site_jumps.length; i++) {
      const internal_site_jump = internal_site_jumps[i];
      internal_site_jump.addEventListener("click", function () {
        $("html, body").animate(
          {
            scrollTop:
              $(
                targets[internal_site_jump.getAttribute("data-target")]
              ).position().top - 80,
          },
          800,
          "swing"
        );
      });
    }
  });

  $(function () {
    const zoom_buttons = $('.zoom_container');
    const popup = $('#popup__img');
    const popup_img = $('#popup__img__content');
    for (let i = 0; i < zoom_buttons.length; i++) {
      const zoom_button = zoom_buttons[i];
      zoom_button.addEventListener('click', function () {
        var src = zoom_button.getAttribute('src');
        popup_img.attr('src' , src);
        popup.addClass('open');
      });
    }
    $('#popup_background').on('click', function () {
      popup.removeClass('open');
    });
    $('#popup_close').on('click', function () {
      popup.removeClass('open');
    });
  });
});

function slideAnime(){
	//====左に動くアニメーションここから===
		$('.leftAnime').each(function(){ 
			var elemPos = $(this).offset().top-50;
			var scroll = $(window).scrollTop();
			var windowHeight = $(window).height();
			if (scroll >= elemPos - windowHeight){
				$(this).addClass("slideAnimeLeftRight"); //要素を左枠外にへ移動しCSSアニメーションで左から元の位置に移動
				$(this).children(".leftAnimeInner").addClass("slideAnimeRightLeft");  //子要素は親要素のアニメーションに影響されないように逆の指定をし元の位置をキープするアニメーションをおこなう
			}else{
				$(this).removeClass("slideAnimeLeftRight");
				$(this).children(".leftAnimeInner").removeClass("slideAnimeRightLeft");
				
			}
		});
	}

	// 画面をスクロールをしたら動かしたい場合の記述
	$(window).scroll(function (){
		slideAnime();
	});

  $(function() {
    var appear = false;
    var pagetop = $('#page_top');
    $(window).scroll(function () {
      if ($(this).scrollTop() > 100) {  //100pxスクロールしたら
        if (appear == false) {
          appear = true;
          pagetop.stop().animate({
            'right': '0px' //右から0pxの位置に
          }, 300); //0.3秒かけて現れる
        }
      } else {
        if (appear) {
          appear = false;
          pagetop.stop().animate({
            'right': '-60px' //右から-50pxの位置に
          }, 300); //0.3秒かけて隠れる
        }
      }
    });
    pagetop.click(function () {
      $('body, html').animate({ scrollTop: 0 }, 500); //0.5秒かけてトップへ戻る
      return false;
    });
  });

